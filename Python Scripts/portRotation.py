import random
import time
import os

#GLOBAL VARIABLES
global numPorts
global portNo
global portArray
global minPort
global maxPort
global sleepDuration
global restrictedArray

#BASIC INITIALIZATION
numPorts = 10
portNo = random.randint(0,numPorts) #Port for NC_BROADCAST
portArray = [None] * numPorts
minPort = 1
maxPort = 65535
sleepDuration = 60 #Seconds
restrictedArray = [22,80,666,1,1337,31337]

#FUNCTION DEFINITIONS
def bashCommands(command):
	os.system(command)

def choose_ports():
	global portNo, portArray, minPort, maxPort, restrictedArray
	COUNTER = 0
	while (COUNTER < numPorts):
		rand = random.randint(minPort,maxPort)
		if rand not in portArray and rand not in restrictedArray:
			portArray[COUNTER] = rand
			COUNTER = COUNTER + 1

def set_nc(): #BroadCast VIA NC on Random Port
	global portNo, portArray
	#bashCommands("echo Starting NC on portNo: " + str(portNo) + " Port: " + str(portArray[portNo]))
	#Make NC Echo to Specific IP	
	bashCommands("echo Yell PopStop to 666\n\rFlag-1:WW91U3Bpbk1lUmlnaHRSb3VuZEJhYnksUmlnaHRSb3VuZAo= ")

def stop_nc(): #Stop BroadCast VIA NC
	global portNo, portArray
	#Stop NC Echo to Specific IP
	bashCommands("echo Stopping NC on portNo: " + str(portNo) + " Port: " + str(portArray[portNo]))

def set_ports(): #Open Chosen Ports
	global portNo, portArray
	NEW=0
	while (NEW < numPorts):
		bashCommands("echo ufw ALLOW " + str(portArray[NEW]))
		NEW = NEW + 1

def modify_ports(): #Close Chosen Ports
	global portNo, portArray, numPorts
	OLD = 0
	while (OLD < numPorts):
		bashCommands("echo ufw DENY " + str(portArray[OLD]))
		OLD = OLD + 1
	portArray = [None] * numPorts

def main():
	#while True: #(Until someone yells StopPop to port 666)
	for i in range(5):
		choose_ports()
		set_ports()
		set_nc()
		time.sleep(sleepDuration)
		stop_nc()
		modify_ports()

#START PROGRAM
main()
