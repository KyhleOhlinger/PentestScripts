from neo4j import GraphDatabase

uri = "bolt://localhost:7687"
driver = GraphDatabase.driver(uri, auth=("<USERNAME>", "<PASSWORD>"))

ACLs = [
    "GenericWrite",
    "GenericAll",
    "ForceChangePassword",
    "Owns",
    "FullControl",
    "WriteDacl",
    "WriteOwner"
]

def print_acl(tx,acl,admin):
    for record in tx.run("MATCH (a:User)-[:"+acl+"]->(u:User) "+admin+" a.admincount RETURN a.name,COUNT(u.name)"):
        print(record["a.name"]+" : "+str(record["COUNT(u.name)"]))  

def main():
    with driver.session() as session:
        for i in range(len(ACLs)):
                print("\n"+ACLs[i]+" with admincount = 0 \n-------------------------------")
                session.read_transaction(print_acl,ACLs[i],"WHERE NOT")
                print("\n"+ACLs[i]+" with admincount = 1 \n-------------------------------")
                session.read_transaction(print_acl,ACLs[i],"WHERE")

print("\n============= Welcome to ACL_Checker =============\n")
main()
print("\n\n============= Checks Completed =============\n")
